{% comment %}
  Meta tags for SEO and social media
{% endcomment %}

{%- assign og_title = page_title -%}
{%- assign og_url = canonical_url -%}
{%- assign og_type = 'website' -%}
{%- assign og_description = page_description | default: shop.description | default: shop.name -%}

{%- if request.page_type == 'product' -%}
  {%- assign og_type = 'product' -%}
  {%- if product.featured_media -%}
    <meta property="og:image" content="http:{{ product.featured_media | image_url: width: 1200 }}">
    <meta property="og:image:secure_url" content="https:{{ product.featured_media | image_url: width: 1200 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="1200">
    <meta name="twitter:image" content="https:{{ product.featured_media | image_url: width: 1200 }}">
  {%- endif -%}
{%- elsif request.page_type == 'article' -%}
  {%- assign og_type = 'article' -%}
  {%- assign og_title = article.title -%}
  {%- assign og_description = article.excerpt | default: article.content | strip_html | truncate: 160 -%}
  {%- if article.image -%}
    <meta property="og:image" content="http:{{ article.image | image_url: width: 1200 }}">
    <meta property="og:image:secure_url" content="https:{{ article.image | image_url: width: 1200 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:image" content="https:{{ article.image | image_url: width: 1200 }}">
  {%- endif -%}
{%- elsif request.page_type == 'collection' -%}
  {%- assign og_title = collection.title -%}
  {%- assign og_description = collection.description | default: collection.title -%}
  {%- if collection.image -%}
    <meta property="og:image" content="http:{{ collection.image | image_url: width: 1200 }}">
    <meta property="og:image:secure_url" content="https:{{ collection.image | image_url: width: 1200 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:image" content="https:{{ collection.image | image_url: width: 1200 }}">
  {%- endif -%}
{%- endif -%}

<meta property="og:site_name" content="{{ shop.name }}">
<meta property="og:url" content="{{ og_url }}">
<meta property="og:title" content="{{ og_title }}">
<meta property="og:type" content="{{ og_type }}">
<meta property="og:description" content="{{ og_description }}">

{%- if settings.favicon != blank -%}
  <meta property="og:image" content="{{ settings.favicon | image_url: width: 1200 }}">
  <meta property="og:image:secure_url" content="{{ settings.favicon | image_url: width: 1200 }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">
{%- endif -%}

<meta name="twitter:site" content="{{ settings.social_twitter_link | split: 'twitter.com/' | last | prepend: '@' }}">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ og_title }}">
<meta name="twitter:description" content="{{ og_description }}">

{%- unless settings.social_twitter_link == blank -%}
  <meta name="twitter:site" content="{{ settings.social_twitter_link | split: 'twitter.com/' | last | prepend: '@' }}">
{%- endunless -%}

{%- if request.page_type == 'product' -%}
  <meta name="twitter:label1" content="{{ 'products.product.price' | t }}">
  <meta name="twitter:data1" content="{% if product.price_varies %}{{ 'products.general.from' | t }} {% endif %}{{ product.price | money_without_currency | strip_html }}{{ shop.currency }}">
  <meta name="twitter:label2" content="{{ 'products.product.vendor' | t }}">
  <meta name="twitter:data2" content="{{ product.vendor }}">
{%- endif -%}

{%- liquid
  assign title_content = page_title
  if current_tags
    assign meta_tags = current_tags | join: ', '
    assign title_content = title_content | append: ' &ndash; tagged ' | append: current_tags | join: ', '
  endif

  unless page_title contains shop.name
    assign title_content = title_content | append: ' &ndash; ' | append: shop.name
  endunless

  if current_page != 1
    assign title_content = 'Page ' | append: current_page | append: ' &ndash; ' | append: title_content
  endif
-%}

{%- liquid
  if request.page_type == 'product' and product.selected_or_first_available_variant
    echo '<script type="application/ld+json">'
    echo '{'
    echo '"@context": "http://schema.org/",'
    echo '"@type": "Product",'
    echo '"name": "' | append: product.title | json | append: '",'
    echo '"url": "' | append: shop.url | append: product.url | append: '",'

    if product.featured_media
      echo '"image": ['
      for media in product.media limit: 3
        echo '"' | append: media | image_url: width: 1024 | append: '"'
        unless forloop.last
          echo ','
        endunless
      endfor
      echo '],'
    endif

    echo '"description": "' | append: product.description | strip_html | json | append: '",'

    if product.vendor != blank
      echo '"brand": {'
      echo '"@type": "Thing",'
      echo '"name": "' | append: product.vendor | json | append: '"'
      echo '},'
    endif

    echo '"offers": {'
    echo '"@type": "Offer",'
    echo '"availability": "' 
    if product.available 
      echo 'https://schema.org/InStock'
    else
      echo 'https://schema.org/OutOfStock'
    endif
    echo '",'
    echo '"price": "' | append: product.selected_or_first_available_variant.price | divided_by: 100.0 | append: '",'
    echo '"priceCurrency": "' | append: cart.currency.iso_code | append: '",'
    echo '"url": "' | append: shop.url | append: product.selected_or_first_available_variant.url | append: '"'

    if product.selected_or_first_available_variant.sku != blank
      echo ',"sku": "' | append: product.selected_or_first_available_variant.sku | append: '"'
    endif

    echo '}'
    echo '}'
    echo '</script>'
  endif
-%}

{%- if request.page_type == 'article' -%}
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "articleBody": {{ article.content | strip_html | json }},
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ request.origin | append: page.url | json }}
  },
  "headline": {{ article.title | json }},
  {% if article.excerpt != blank %}
    "description": {{ article.excerpt | strip_html | json }},
  {% endif %}
  {% if article.image %}
    "image": [
      {{ article | image_url: width: 1920 | prepend: "https:" | json }}
    ],
  {% endif %}
  "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
  "dateCreated": {{ article.created_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
  "author": {
    "@type": "Person",
    "name": {{ article.author | json }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ shop.name | json }}
  }
}
</script>
{%- endif -%}

{%- if request.page_type == 'index' -%}
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "name": {{ shop.name | json }},
  "potentialAction": {
    "@type": "SearchAction",
    "target": {{ potential_action_target | json }},
    "query-input": "required name=search_term_string"
  },
  "url": {{ shop.url | append: page.url | json }}
}
</script>
{%- endif -%}