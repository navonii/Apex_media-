{% comment %}
  The product template is used to display individual products and their variants.
{% endcomment %}

<div class="template-product">
  <div class="page-width">
    <div class="product-single">
      <div class="grid product-single__grid">
        <div class="grid__item medium-up--one-half">
          <div class="product-single__photos">
            {% if product.images.size > 0 %}
              <div class="product-single__photo">
                {{ product.featured_image | image_url: width: 600 | image_tag: alt: product.featured_image.alt }}
              </div>
              
              {% if product.images.size > 1 %}
                <div class="product-single__thumbnails">
                  {% for image in product.images %}
                    <div class="product-single__thumbnail">
                      {{ image | image_url: width: 100 | image_tag: alt: image.alt }}
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            {% else %}
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {% endif %}
          </div>
        </div>

        <div class="grid__item medium-up--one-half">
          <div class="product-single__meta">
            <h1 class="product-single__title">{{ product.title }}</h1>
            
            {% unless product.empty? %}
              <div class="product-single__prices">
                <span class="product-single__price">
                  {{ product.selected_or_first_available_variant.price | money }}
                </span>
                {% if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price %}
                  <span class="product-single__price--compare">
                    {{ product.selected_or_first_available_variant.compare_at_price | money }}
                  </span>
                {% endif %}
              </div>
            {% endunless %}

            {% unless product.empty? %}
              <form action="/cart/add" method="post" enctype="multipart/form-data">
                {% if product.variants.size > 1 %}
                  <div class="product-form__variants">
                    {% for option in product.options_with_values %}
                      <div class="product-form__option">
                        <label for="SingleOptionSelector-{{ forloop.index0 }}">{{ option.name }}</label>
                        <select class="single-option-selector" id="SingleOptionSelector-{{ forloop.index0 }}" data-index="option{{ option.position }}">
                          {% for value in option.values %}
                            <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>{{ value }}</option>
                          {% endfor %}
                        </select>
                      </div>
                    {% endfor %}
                  </div>
                {% endif %}

                <select name="id" id="ProductSelect" style="display: none;">
                  {% for variant in product.variants %}
                    <option {% if variant == product.selected_or_first_available_variant %}selected="selected"{% endif %} value="{{ variant.id }}">{{ variant.title }}</option>
                  {% endfor %}
                </select>

                <div class="product-form__cart">
                  <div class="product-form__quantity">
                    <label for="Quantity">{{ 'products.product.quantity' | t }}</label>
                    <input type="number" id="Quantity" name="quantity" value="1" min="1">
                  </div>
                  
                  <button type="submit" name="add" class="product-form__cart-submit btn">
                    <span>{{ 'products.product.add_to_cart' | t }}</span>
                  </button>
                </div>
              </form>
            {% endunless %}

            {% if product.description != blank %}
              <div class="product-single__description rte">
                {{ product.description }}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .template-product {
    padding: 2rem 0;
  }
  
  .product-single__grid {
    align-items: flex-start;
    gap: 3rem;
  }
  
  .product-single__photo img {
    width: 100%;
    height: auto;
    border-radius: 0.5rem;
  }
  
  .product-single__thumbnails {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  
  .product-single__thumbnail {
    width: 80px;
    height: 80px;
    cursor: pointer;
  }
  
  .product-single__thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 0.25rem;
  }
  
  .product-single__title {
    font-size: 2rem;
    margin-bottom: 1rem;
  }
  
  .product-single__prices {
    margin-bottom: 1.5rem;
  }
  
  .product-single__price {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-primary);
  }
  
  .product-single__price--compare {
    font-size: 1.25rem;
    text-decoration: line-through;
    color: rgb(156 163 175);
    margin-left: 0.5rem;
  }
  
  .product-form__option {
    margin-bottom: 1rem;
  }
  
  .product-form__option label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
  }
  
  .product-form__option select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid rgb(209 213 219);
    border-radius: 0.25rem;
  }
  
  .product-form__cart {
    display: flex;
    gap: 1rem;
    align-items: end;
    margin-bottom: 2rem;
  }
  
  .product-form__quantity label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
  }
  
  .product-form__quantity input {
    width: 80px;
    padding: 0.75rem;
    border: 1px solid rgb(209 213 219);
    border-radius: 0.25rem;
  }
  
  .product-form__cart-submit {
    background: var(--gradient-primary);
    color: white;
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
  }
  
  .product-single__description {
    margin-top: 2rem;
    line-height: 1.6;
  }
  
  @media (max-width: 768px) {
    .product-single__grid {
      grid-template-columns: 1fr;
    }
    
    .product-form__cart {
      flex-direction: column;
      align-items: stretch;
    }
  }
</style>

<script>
  // Handle variant selection
  document.addEventListener('DOMContentLoaded', function() {
    const selectors = document.querySelectorAll('.single-option-selector');
    const productSelect = document.getElementById('ProductSelect');
    
    if (selectors.length && productSelect) {
      selectors.forEach(function(selector) {
        selector.addEventListener('change', function() {
          const selectedOptions = Array.from(selectors).map(s => s.value);
          const variants = {{ product.variants | json }};
          
          const selectedVariant = variants.find(variant => {
            return variant.options.every((option, index) => option === selectedOptions[index]);
          });
          
          if (selectedVariant) {
            productSelect.value = selectedVariant.id;
          }
        });
      });
    }
  });
</script>